
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Distributed video hosting for Moodle and other LMS">
      
      
      
        <link rel="canonical" href="https://innocampus.github.io/videbo/usage/">
      
      
        <link rel="prev" href="..">
      
      
        <link rel="next" href="../advanced-config/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.13">
    
    
      
        <title>Usage - Videbo</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.ffa9267a.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../css/extra.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="tub" data-md-color-primary="" data-md-color-accent="red">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#intro" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Videbo" class="md-header__button md-logo" aria-label="Videbo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Videbo
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Usage
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="tub" data-md-color-primary="" data-md-color-accent="red"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent="red"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/innocampus/videbo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    innocampus/videbo
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Videbo" class="md-nav__button md-logo" aria-label="Videbo" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Videbo
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/innocampus/videbo" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    innocampus/videbo
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Usage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Usage
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intro" class="md-nav__link">
    Intro
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-a-storage-node" class="md-nav__link">
    Running a Storage Node
  </a>
  
    <nav class="md-nav" aria-label="Running a Storage Node">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-config-file" class="md-nav__link">
    Creating a config file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starting-the-server" class="md-nav__link">
    Starting the server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connect-a-moodle-instance" class="md-nav__link">
    Connect a Moodle instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#securing-the-storage-node" class="md-nav__link">
    Securing the Storage Node
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-a-distributor-node" class="md-nav__link">
    Running a Distributor Node
  </a>
  
    <nav class="md-nav" aria-label="Running a Distributor Node">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-the-nodes" class="md-nav__link">
    Configuring the nodes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starting-the-distributor-node" class="md-nav__link">
    Starting the Distributor Node
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../advanced-config/" class="md-nav__link">
        Advanced configuration
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../reverse-proxy/" class="md-nav__link">
        Reverse proxy
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#intro" class="md-nav__link">
    Intro
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-a-storage-node" class="md-nav__link">
    Running a Storage Node
  </a>
  
    <nav class="md-nav" aria-label="Running a Storage Node">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-config-file" class="md-nav__link">
    Creating a config file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starting-the-server" class="md-nav__link">
    Starting the server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#connect-a-moodle-instance" class="md-nav__link">
    Connect a Moodle instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#securing-the-storage-node" class="md-nav__link">
    Securing the Storage Node
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#running-a-distributor-node" class="md-nav__link">
    Running a Distributor Node
  </a>
  
    <nav class="md-nav" aria-label="Running a Distributor Node">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#configuring-the-nodes" class="md-nav__link">
    Configuring the nodes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#starting-the-distributor-node" class="md-nav__link">
    Starting the Distributor Node
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Usage</h1>

<h2 id="intro">Intro</h2>
<p>With <strong>Videbo</strong> there are three fundamental modes of operation:</p>
<ul>
<li>Running a <strong>Storage</strong> Node</li>
<li>Running a <strong>Distributor</strong> Node</li>
<li>Executing <strong>administrative</strong> commands</li>
</ul>
<p>The <strong>Storage</strong> Node is the central part of the <strong>Videbo</strong>. It encompasses the main video hosting API, format checking, monitoring capabilities (optional), and distribution logic (optional). It has its own webserver and it can be run as a standalone service. Every Videbo setup requires exactly one Storage Node.</p>
<p>The purpose of a <strong>Distributor</strong> Node is to provide load balancing and redundancy to a Videbo hosting service. Any (reasonable) number of Distributor Nodes can be connected to one Storage Node. Depending on the overall configuration and load, requests for video streams are automatically redirected from Storage to Distributor.</p>
<p>Additionally, Videbo has a built-in <strong>command line interface</strong> (CLI). It can be used for communication and even on-line interaction with a running Storage Node. It allows you to query the current node status, find orphaned files, as well as to disable/enable Distributor Nodes on the fly.</p>
<p>The following sections give an overview of the core functionality of <strong>Videbo</strong> in the most common use cases.</p>
<h2 id="running-a-storage-node">Running a Storage Node</h2>
<h3 id="creating-a-config-file">Creating a config file</h3>
<p>After <a href="/#installation">installing</a> Videbo, create a configuration file:
<div class="highlight"><pre><span></span><code>mkdir<span class="w"> </span>/etc/videbo
touch<span class="w"> </span>/etc/videbo/config.toml
</code></pre></div>
Videbo uses the <a class="external-link" href="https://toml.io/" target="_blank">TOML</a> format for all its configuration files. The default configuration file path for a Videbo node is <code>/etc/videbo/config.toml</code>.</p>
<p>The minimum recommendation is to at least configure your storage directory. This is where all the video files will be uploaded, where the thumbnails will be save, etc.</p>
<p>By default, files will be stored in <code>/tmp/videbo</code>.</p>
<p>To specify your storage directory, open the configuration file and add the following:
<div class="highlight"><span class="filename">config.toml</span><pre><span></span><code><span class="n">files_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/path/to/video/storage&quot;</span>
</code></pre></div></p>
<p>Make sure the directory exists and your user has write access to it.</p>
<h3 id="starting-the-server">Starting the server</h3>
<p>Now you can run the storage node:
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>videbo<span class="w"> </span>storage
</code></pre></div></p>
<p>You should immediately see a few log messages appear in your terminal followed by a notice about where your server is listening:
<div class="highlight"><pre><span></span><code>...
INFO:videbo.storage.util:Found 0 videos in storage
...
======== Running on http://127.0.0.1:9020 ========
(Press CTRL+C to quit)
</code></pre></div></p>
<p>As you can see, by default, the server will listen for incoming requests on <a href="http://127.0.0.1:9020">http://127.0.0.1:9020</a>. If you want it to bind to a different port, say <code>8080</code>, you can do so via the command line:
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>videbo<span class="w"> </span>-P<span class="w"> </span><span class="m">8080</span><span class="w"> </span>storage
</code></pre></div></p>
<p>Alternatively, you can set the port in your config file:
<div class="highlight"><span class="filename">config.toml</span><pre><span></span><code><span class="n">files_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/path/to/video/storage&quot;</span>
<span class="hll"><span class="n">listen_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8080</span>
</span></code></pre></div></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Command line parameters will always take precedence over the configuration file.</p>
</div>
<p>All available configuration options are explained <a class="internal-link" href="#">here</a>.</p>
<p>Technically, this setup is all you need for <strong>Videbo</strong>.</p>
<h3 id="connect-a-moodle-instance">Connect a Moodle instance</h3>
<p>To try it out with a local Moodle instance, you can install the <a class="external-link" href="https://github.com/innocampus/moodle-mod_videoservice" target="_blank"><strong><code>mod_videoservice</code></strong></a> there, then navigate to <code>Plugins</code> &rarr; <code>Activity modules</code> &rarr; <code>Video service</code> and adjust the video server URL in the settings:
<div class="highlight"><span class="filename">video_server_url</span><pre><span></span><code>http://localhost:8080
</code></pre></div></p>
<p>Since we changed the listen port, we will need to adjust the "public" facing URL of our Storage Node accordingly, so that Moodle can route our video requests properly:
<div class="highlight"><span class="filename">config.toml</span><pre><span></span><code><span class="n">files_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/path/to/video/storage&quot;</span>
<span class="n">listen_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8080</span>
<span class="hll"><span class="n">public_base_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://localhost:8080&quot;</span>
</span></code></pre></div></p>
<p>Then create a <strong><code>Video</code></strong> activity within a course. Inside that activity you can now upload, manage, stream, and download videos. The files should appear inside your <code>/path/to/video/storage</code> directory.</p>
<h3 id="securing-the-storage-node">Securing the Storage Node</h3>
<p>In production, this setup would be completely insecure because we did not define a <strong>shared secret</strong> between our Moodle instance and <strong>Videbo</strong>. Without that, anyone could theoretically upload videos to a public facing Storage Node. We secure our <strong>Videbo</strong> Node in the config file:
<div class="highlight"><span class="filename">config.toml</span><pre><span></span><code><span class="n">files_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/path/to/video/storage&quot;</span>
<span class="n">listen_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8080</span>
<span class="n">public_base_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://localhost:8080&quot;</span>
<span class="hll"><span class="n">internal_api_secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;OUR_SUPER_SECURE_INTERNAL_SECRET&#39;</span>
</span><span class="hll"><span class="n">external_api_secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;OUR_SUPER_SECURE_EXTERNAL_SECRET&#39;</span>
</span></code></pre></div></p>
<p>The <code>internal_api_secret</code> is what secures the node for administrative commands.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In TOML a <a class="external-link" href="https://toml.io/en/latest#string" target="_blank">string</a> value can be safely enclosed in single quotes <code>'</code>, if it is supposed to be a literal and not have special escape sequences (e.g. <code>jC\n:6s[z</code>). This is useful for things like passwords. If the string itself may contain single quotes, a multi-line literal can be used that is enclosed by three single quotes <code>'''</code>.</p>
</div>
<p>The <code>external_api_secret</code> is shared with our Moodle instance. We again set it in the <code>Video service</code> Plugin settings:
<div class="highlight"><span class="filename">video_api_secret</span><pre><span></span><code>OUR_SUPER_SECURE_EXTERNAL_SECRET
</code></pre></div></p>
<h2 id="running-a-distributor-node">Running a Distributor Node</h2>
<h3 id="configuring-the-nodes">Configuring the nodes</h3>
<p>The setup for a Distributor Node is essentially the same as with the Storage Node. Following installation we need to create a config file.</p>
<p>If we just want to have a local testing setup, we can spin up a Distributor Node on the same host as our Storage Node. To do that, we need to put the Distributor Node configuration in a separate file:
<div class="highlight"><span class="filename">config.toml (Distributor)</span><pre><span></span><code><span class="n">files_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/path/to/video/distributor&quot;</span>
<span class="n">listen_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8081</span>
<span class="n">public_base_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://localhost:8080&quot;</span>
<span class="n">internal_api_secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;OUR_SUPER_SECURE_INTERNAL_SECRET&#39;</span>
<span class="n">external_api_secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;OUR_SUPER_SECURE_EXTERNAL_SECRET&#39;</span>
</code></pre></div></p>
<p>We already discussed why we configure the files path, listen port, and secrets in the <a href="#running-a-storage-node">Storage section</a>. We let our Distributor Node bind locally to port <code>8081</code> in this example.</p>
<p>The config parameter <code>public_base_url</code> must to be set to the <strong>same value as on our Storage Node</strong>. In this case, since we are creating a local test-setup, the url is <code>http://localhost:8080</code> as we configured it in the previous chapter.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If we just want to have a local testing setup, we can spin up a Distributor Node on the same host as our Storage Node. To do that, we need to put the Distributor Node configuration in a separate file (say <code>/etc/videbo/config_dist.toml</code>) and launch it with the <code>-c</code> command line option (see below).</p>
</div>
<p>Next, we need to configure our Storage Node to make it aware of the available Distributor:
<div class="highlight"><span class="filename">config.toml</span><pre><span></span><code><span class="n">files_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;/path/to/video/storage&quot;</span>
<span class="n">listen_port</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">8080</span>
<span class="n">public_base_url</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://localhost:8080&quot;</span>
<span class="n">internal_api_secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;OUR_SUPER_SECURE_INTERNAL_SECRET&#39;</span>
<span class="n">external_api_secret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;OUR_SUPER_SECURE_EXTERNAL_SECRET&#39;</span>

<span class="hll"><span class="k">[distribution]</span>
</span><span class="hll"><span class="n">static_node_base_urls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;http://localhost:8081&quot;</span>
</span></code></pre></div>
The <code>static_node_base_urls</code> parameter accepts either an array or a comma-separated list of Distributor Node base URLs. (If there is only one distributor node, a single URL is also valid.)</p>
<h3 id="starting-the-distributor-node">Starting the Distributor Node</h3>
<p>Once the setup is complete, we can start the Distributor Node:
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>videbo<span class="w"> </span>distributor
</code></pre></div></p>
<p>Again, you should see some logs appear in the terminal and a notice about where the server is listening. <strong>Only now</strong>, once the the Distributor has started, should you (re-)start the Storage Node from a separate terminal:
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>videbo<span class="w"> </span>storage
</code></pre></div></p>
<p>If the config files are located under different paths (e.g. because we want two nodes running on the same host), we can specify them using the <code>-c</code>/<code>--config-file-paths</code> CLI option:
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>videbo<span class="w"> </span>-c<span class="w"> </span>./config_dist.toml<span class="w"> </span>distributor
</code></pre></div></p>
<div class="highlight"><pre><span></span><code>python<span class="w"> </span>-m<span class="w"> </span>videbo<span class="w"> </span>-c<span class="w"> </span>./config_storage.toml<span class="w"> </span>storage
</code></pre></div>
<p>The Storage Node will immediately begin its periodical checks of the status of the enabled Distributor Nodes. In the log output of the Storage Node, you should see a message like this:
<div class="highlight"><pre><span></span><code>...
======== Running on http://127.0.0.1:8080 ========
...
INFO:videbo.storage.distribution:&lt;Distribution watcher http://localhost:8081&gt; connected. Free space currently: ... MB
INFO:videbo.storage.distribution:Found 0 files on http://localhost:8081
</code></pre></div></p>
<p>Whereas the Distributor will output messages about incoming status requests every few seconds. These are made by the Storage Node.</p>
<p>...</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      © 2022 innoCampus, Technische Universität Berlin
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.2a6f1dda.min.js"></script>
      
    
  </body>
</html>